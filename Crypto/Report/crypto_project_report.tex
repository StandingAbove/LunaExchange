\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath,amssymb,booktabs,longtable}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=1.18}
\hypersetup{colorlinks=true,linkcolor=blue,urlcolor=blue,citecolor=blue}

\title{LunaExchange Crypto Project: End-to-End Technical Report}
\author{Automated Project Synthesis}
\date{\today}

\begin{document}
\maketitle

\begin{abstract}
This report documents the full \texttt{Crypto/} subsystem in LunaExchange: data cleaning, model logic, backtesting and cost accounting, validation workflow, and empirical performance. This revision is intentionally \textbf{text-and-data only} (no binary image artifacts), and all visualizations are rendered directly in LaTeX using CSV inputs.
\end{abstract}

\tableofcontents
\newpage

\section{Project Scope}
The \texttt{Crypto/} folder provides a modular quant-research stack over BTC/ETH with:
\begin{itemize}
    \item signal models (z-score hybrid, trend, OU, pair trading),
    \item unified backtest engine with cost model,
    \item validation modules (walk-forward, stability surface, Monte Carlo),
    \item research notebooks for exploration and model iteration.
\end{itemize}

\section{Folder Coverage}
\begin{itemize}
    \item \texttt{main.py}: orchestrates model selection, backtests, walk-forward, stability, and MC reporting.
    \item \texttt{Data/raw\_data\_loader.py}: schema checks, date parsing, duplicate filtering, numeric coercion, outlier rejection.
    \item \texttt{Models/}: z-score hybrid, trend, OU, pair-trading logic.
    \item \texttt{Backtest/}: gross/net returns, fees/slippage/funding/borrow costs, and performance metrics.
    \item \texttt{Validation/}: rolling/expanding OOS tests, parameter-surface robustness, and bootstrap-based diagnostics.
    \item \texttt{Research/}: notebook pipeline for BTC, ETH, pair testing, walk-forward and robustness experiments.
\end{itemize}

\section{Core Equations}
For position $w_t$, underlying return $r_t$, and cost $C_t$:
\begin{align}
R_t^{\text{gross}} &= w_t r_t, \\
R_t^{\text{net}} &= R_t^{\text{gross}} - C_t, \\
E_t &= \prod_{i\le t}(1 + R_i^{\text{net}}).
\end{align}

Z-score residual framework:
\begin{align}
\varepsilon_t &= P_t - \text{MA}_W(P_t), \\
z_t &= \frac{\varepsilon_t - \text{MA}_W(\varepsilon_t)}{\text{STD}_W(\varepsilon_t)}.
\end{align}

Pair spread framework:
\begin{align}
\beta_t &= \frac{\mathrm{Cov}(\log B_t,\log E_t)}{\mathrm{Var}(\log E_t)}, \\
S_t &= \log B_t - \beta_t \log E_t.
\end{align}

\section{Configuration Snapshot}
Defaults used for this run:
\begin{itemize}
    \item fee = 10 bps, slippage = 5 bps, leverage cap = 1.5,
    \item walk-forward train/test = 3y/1y (rolling),
    \item z-score window 180, entry/exit = 2.0/0.0,
    \item trend windows 20/128 with 1.3/1.0/0.7 leverage tiers,
    \item OU window 180, entry/exit = 1.5/0.0,
    \item pair beta/z windows 180/180, entry/exit = 2.0/0.0.
\end{itemize}

\section{Performance Table}
\pgfplotstabletypeset[
    col sep=comma,
    string type,
    columns={Model,Sharpe,CAGR,MaxDD,AnnualReturn,AnnualVol,AnnualTurnover},
    columns/Model/.style={column type=l},
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule}
]{model_metrics.csv}

\section{Visualizations (Rendered from CSV, No Binary Files)}
\subsection{Risk/Return Profile (Grouped Bars)}
\begin{center}
\begin{tikzpicture}
\begin{axis}[
    ybar,
    width=0.95\textwidth,
    height=7cm,
    bar width=8pt,
    ylabel={Value},
    symbolic x coords={Trend (BTC),OU (BTC),Z-Score (BTC),Pair BTC-ETH},
    xtick=data,
    x tick label style={rotate=20,anchor=east,font=\small},
    legend style={at={(0.5,1.15)},anchor=south,legend columns=3,font=\small},
    ymin=-1,
    ymax=1.0,
    nodes near coords,
    nodes near coords align={vertical},
]
\addplot+[fill=blue!45] table[x=Model,y=Sharpe,col sep=comma] {model_metrics.csv};
\addplot+[fill=green!45] table[x=Model,y=CAGR,col sep=comma] {model_metrics.csv};
\addplot+[fill=red!45] table[x=Model,y=MaxDD,col sep=comma] {model_metrics.csv};
\legend{Sharpe,CAGR,MaxDD}
\end{axis}
\end{tikzpicture}
\end{center}

\subsection{Exposure-State Composition (100\% Stacked Bars)}
\begin{center}
\begin{tikzpicture}
\begin{axis}[
    ybar stacked,
    width=0.95\textwidth,
    height=7cm,
    bar width=14pt,
    ymin=0,ymax=100,
    ylabel={Share of Days (\%)},
    symbolic x coords={Z-Score (BTC),Trend (BTC),OU (BTC),Pair BTC-ETH},
    xtick=data,
    x tick label style={rotate=20,anchor=east,font=\small},
    legend style={at={(0.5,1.15)},anchor=south,legend columns=3,font=\small},
]
\addplot+[fill=red!60] table[x=Model,y={Short %},col sep=comma] {state_occupancy.csv};
\addplot+[fill=gray!60] table[x=Model,y={Flat %},col sep=comma] {state_occupancy.csv};
\addplot+[fill=green!60] table[x=Model,y={Long %},col sep=comma] {state_occupancy.csv};
\legend{Short,Flat,Long}
\end{axis}
\end{tikzpicture}
\end{center}

\subsection{Validation Snapshot}
\begin{itemize}
    \item Walk-forward OOS Sharpe: \textbf{0.837}.
    \item Stability surface metrics: best=median=0.778, std=0.000, peak/median=1.000.
    \item Monte Carlo: actual Sharpe 0.767; IID mean 0.763; block mean 0.758.
\end{itemize}

\section{Interpretation}
\begin{enumerate}
    \item Trend (BTC) is strongest under current defaults (highest Sharpe and CAGR).
    \item OU is competitive and turnover-efficient.
    \item Z-score remains viable but turnover-heavy.
    \item Pair BTC--ETH is weak net-of-cost and likely needs reparameterization.
\end{enumerate}

\section{Artifacts}
This report is intentionally binary-free. Reproducibility files:
\begin{itemize}
    \item \texttt{model\_metrics.csv}
    \item \texttt{state\_occupancy.csv}
    \item \texttt{validation\_summary.json}
\end{itemize}

\end{document}
